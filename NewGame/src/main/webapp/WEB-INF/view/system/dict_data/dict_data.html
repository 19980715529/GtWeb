@layout("/common/_container.html"){
<script src="${ctxPath}/static/layui-v2.8.4/layui/layui.js"></script>
<link href="${ctxPath}/static/layui-v2.8.4/layui/css/layui.css" rel="stylesheet">
<table class="layui-hide" id="ID-treeTable-demo"></table>
<script type="text/html" id="TPL-treeTable-demo">
    <div class="layui-btn-container">
        <button class="layui-btn layui-btn-sm" lay-event="addChecked">添加</button>
        <button class="layui-btn layui-btn-danger layui-btn-sm" lay-event="remove">删除</button>
    </div>
</script>
<script type="text/html" id="TPL-treeTable-demo-tools">
    <div class="layui-btn-container">
        <a class="layui-btn layui-btn-xs" lay-event="addChild">新增</a>
        <a class="layui-btn layui-btn-warm layui-btn-xs" lay-event="edit">修改</a>
    </div>
</script>
<script>
    var ctx = "${ctxPath}";
    layui.use(function(){
        var treeTable = layui.treeTable;
        var layer = layui.layer;
        var dropdown = layui.dropdown;
        // 渲染
        var inst = treeTable.render({
            elem: '#ID-treeTable-demo',
            url: ctx+'/dict_data/list', // 此处为静态模拟数据，实际使用时需换成真实接口
            tree: {
                /*
                // 异步加载子节点
                async: {
                  enable: true,
                  url: '/static/json/treeTable/demo-async.json', // 此处为静态模拟数据，实际使用时需换成真实接口
                  autoParam: ["parentId=id"]
                }
                */
            },
            maxHeight: '701px',
            toolbar: '#TPL-treeTable-demo',
            cols: [[
                {type: 'checkbox', fixed: 'left'},
                {field: 'id', title: 'ID', width: 80, sort: true, fixed: 'left'},
                {field: 'name', title: '字典名称', width: 180, fixed: 'left'},
                {field: 'code', title: '字典编码', width: 180},
                {field: 'value', title: '字典参数'},
                {field: 'param', title: '字典额外参数'},
                {field: 'num', title: '排序', sort: true},
                {field: 'pcode', title: '父编码'},
                {field: 'isOpen', title: '是否启用'},
                {field: 'tips', title: '备注'},
                { fixed: "right", title: "操作", width: 181, align: "center", toolbar: "#TPL-treeTable-demo-tools"}
            ]],
            page: false
            , request: {
                pageName: 'page', // 页码的参数名称，默认：page
                limitName: 'rows' // 每页数据条数的参数名，默认：limit
            },
            parseData: function (res) { // res 即为原始返回的数据
                return {
                    "code": res.code, // 解析接口状态
                    "msg": res.msg, // 解析提示文本
                    "count": res.data.records, // 解析数据长度
                    "data": res.data.rows // 解析数据列表
                };
            }
        });
        // 表头工具栏工具事件
        treeTable.on("toolbar(ID-treeTable-demo)", function (obj) {
            var config = obj.config;
            var tableId = config.id;
            var status = treeTable.checkStatus(tableId);
            // 获取选中行
            if (obj.event === "addChecked") {
                // if(!status.data.length) return layer.msg('无选中数据'); 添加
                // console.log(status);
                let index=layer.open({
                    type: 2, // page 层类型
                    area: ['500px', '650px'],
                    title: '添加',
                    shade: 0.6, // 遮罩透明度
                    shadeClose: true, // 点击遮罩区域，关闭弹层
                    maxmin: true, // 允许全屏最小化
                    anim: 0, // 0-6 的动画形式，-1 不开启
                    content: ['${ctxPath}/dict_data/add','yes'],
                });
            }else if (obj.event === "remove"){
                if(!status.data.length) return layer.msg('无选中数据')
                layer.confirm("真的删除行么,此操作不可逆！", function (index) {
                    layer.close(index);
                    let checkVal = status.data
                    let ids=checkVal.map((item)=>{
                        return item.id
                    })
                    $.ajax({
                        url:"${ctxPath}/dict_data/remove", // 请求路径
                        type:"POST" , //请求方式
                        data: "ids="+ids.join(","),//请求参数
                        // data:JSON.stringify(field),
                        dataType:"json",//设置接受到的响应数据的格式
                        // contentType:"application/json",
                        success:function (data) {
                            if (data.code ===0){
                                layer.msg(data.message)
                            }else {
                                layer.msg(data.message)
                            }
                            treeTable.reload("ID-treeTable-demo")
                        },//响应成功后的回调函数
                        error:function (err) {
                            layer.msg('服务器异常')
                        },//表示如果请求响应出现错误，会执行的回调函数
                    })
                });
            }
        });
        // 单元格工具事件
        treeTable.on('tool('+ inst.config.id +')', function (obj) {
            var layEvent = obj.event; // 获得 lay-event 对应的值
            var trElem = obj.tr;
            var trData = obj.data;
            var tableId = obj.config.id;
            if (layEvent === "edit") {
                layer.open({
                    type: 2, // page 层类型
                    area: ['500px', '650px'],
                    title: '修改',
                    shade: 0.6, // 遮罩透明度
                    shadeClose: true, // 点击遮罩区域，关闭弹层
                    maxmin: true, // 允许全屏最小化
                    anim: 0, // 0-6 的动画形式，-1 不开启
                    content: ['${ctxPath}/dict_data/edit/'+trData.id,'yse'],
                });
            } else if (layEvent === "addChild") {
                layer.open({
                    type: 2, // page 层类型
                    area: ['500px', '650px'],
                    title: '添加',
                    shade: 0.6, // 遮罩透明度
                    shadeClose: true, // 点击遮罩区域，关闭弹层
                    maxmin: true, // 允许全屏最小化
                    anim: 0, // 0-6 的动画形式，-1 不开启
                    content: ['${ctxPath}/dict_data/add?id='+trData.id,'yes'],
                });
            }
        });
    });
</script>
<!-- 引入列表页所需js -->
@include("/common/_listscript.html"){}
@}