@layout("/common/_container.html"){
<script src="${ctxPath}/static/layui-v2.8.4/layui/layui.js"></script>
<link href="${ctxPath}/static/layui-v2.8.4/layui/css/layui.css" rel="stylesheet">
<script type="text/html" id="RechargeUserID">
    <a href="${ctxPath}/player/detailinfo/{{= d.RechargeUserID }}" style="color:royalblue;font-size:16px" target="_blank">{{= d.RechargeUserID }}</a>
</script>
<script type="text/html" id="AgentUser_id">
    <a href="${ctxPath}/player/detailinfo/{{= d.AgentUserID }}" style="color:royalblue;font-size:16px" target="_blank">{{= d.AgentUserID }}</a>
</script>
<script type="text/html" id="AgentUpUserID">
    <a href="${ctxPath}/player/detailinfo/{{= d.AgentUpUserID }}" style="color:royalblue;font-size:16px" target="_blank">{{= d.AgentUpUserID }}</a>
</script>
<script type="text/html" id="TPL-treeTable-demo-tools">
    <div class="layui-btn-container">
<!--        <a class="layui-btn layui-btn-xs" lay-event="addChild">新增</a>-->
        <a class="layui-btn layui-btn-warm layui-btn-xs" lay-event="edit">修改</a>
    </div>
</script>
<script type="text/html" id="ID-table-templet-switch">
    <!-- 这里的 checked 的状态值判断仅作为演示 -->
    <input type="checkbox" name="isOpen" value="{{= d.id }}" title="开|关" lay-skin="switch" lay-filter="demo-templet-status" {{= d.isOpen == 0 ? "checked" : "" }}>
</script>
<div class="layui-row">
</div>
<table class="layui-hide" id="ID-table-demo-search"></table>
<script>
    var ctx = "${ctxPath}";
    var _filter = '';
    console.log(ctx + "/${code}/list")
    layui.use(function () {
        var laydate = layui.laydate;
        // 日期范围 - 左右面板独立选择模式
        laydate.render({
            elem: '#ID-laydate-start-date',
            value: getCurrentMonthFirst().format('yyyy-MM-dd'),
            isInitValue: true
        })
        laydate.render({
            elem: '#ID-laydate-end-date',
            value: getBeforeDate(0),
            isInitValue: true
        })
        laydate.render({
            elem: '#ID-laydate-range',
            range: ['#ID-laydate-start-date', '#ID-laydate-end-date']
        });
        var table = layui.table;
        var form = layui.form;
        // 创建表格实例
        table.render({
            elem: '#ID-table-demo-search'
            , url: ctx + "/${code}/list" // 此处为静态模拟数据，实际使用时需换成真实接口
            , toolbar: true
            , defaultToolbar: ['filter', 'exports', 'print']  //工具
            , where: {
                where: _filter,
                _search: false,
                nd: new Date().getTime(),
                sidx: "",
                sord: "asc"
            }
            , limit: 50
            , limits: [10, 50, 100]
            , request: {
                pageName: 'page', // 页码的参数名称，默认：page
                limitName: 'rows' // 每页数据条数的参数名，默认：limit
            },
            parseData: function (res) { // res 即为原始返回的数据
                return {
                    "code": res.code, // 解析接口状态
                    "msg": res.msg, // 解析提示文本
                    "count": res.data.records, // 解析数据长度
                    "data": res.data.rows // 解析数据列表
                };
            }
            , cols: [[
                { type: 'numbers', title: '序号', width: 80, fixed: 'left' }// 序号
                ,{field: 'id', title: 'ID', width: 150, sort: true, fixed: 'left'}
                , {field: 'name', title: '身份', width: 180, fixed: 'left'}
                , {field: 'level1', title: '快捷1'}
                , {field: 'level2', title: '快捷2'}
                , {field: 'level3', title: '快捷3'}
                , {field: 'level4', title: '快捷4'}
                , {field: 'level5', title: '快捷5'}
                , {field: 'level6', title: '快捷6'}
                , {field: 'level7', title: '快捷7'}
                , {field: 'level8', title: '快捷8'}
                , {field: 'isOpen', title: '是否开启',templet: '#ID-table-templet-switch'}
                ,{ fixed: "right", title: "操作", width: 181, align: "center", toolbar: "#TPL-treeTable-demo-tools"}
            ]]
            , totalRow: false // 开启合计行
            , page: true
            , height: 650
        });
        // 搜索提交
        form.on('submit(demo-table-search)', function (data) {
            var field = data.field; // 获得表单字段
            // 执行搜索重载
            table.reload('ID-table-demo-search', {
                page: {
                    curr: 1 // 重新从第 1 页开始
                }
                , where: {
                    where:'',
                    _search: false,
                    nd: new Date().getTime(),
                    sidx: "",
                    sord: "asc"
                }
            });
            // layer.msg('搜索成功<br>此处为静态模拟数据，实际使用时换成真实接口即可');
            return false; // 阻止默认 form 跳转
        });
        // 状态 - 开关操作
        form.on('switch(demo-templet-status)', function(obj){
            var key = this.value;
            var status=0;
            if(obj.elem.checked){
                status=0
            }else {
                status=1
            }
            layui.jquery.ajax({
                url: '${ctxPath}/transferconfig/update/status',
                data: "id="+key+"&isOpen="+status,
                dataType: 'json',
                type: 'POST',
                // contentType:'application/json;charset=utf-8',
                success:function(result){
                    if(result.code != 0){
                        parent.layer.msg(result.message, {shade: 0.3})
                    }else{
                        //当你在iframe页面关闭自身时
                        var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
                        //layer信息提示
                        setTimeout(function () { parent.layer.close(index) }, 330);//延迟
                        parent.layer.msg(result.message,{shade: 0.3})
                        setTimeout(function () {
                            location.reload();
                        },500)
                    }
                }
            });
        });
        // 单元格工具事件
        table.on('tool(ID-table-demo-search)', function (obj) {
            var layEvent = obj.event; // 获得 lay-event 对应的值
            // var trElem = obj.tr;
            var trData = obj.data;
            // var tableId = obj.config.id;
            if (layEvent === "edit") {
                layer.open({
                    type: 2, // page 层类型
                    area: ['500px', '650px'],
                    title: '修改',
                    shade: 0.6, // 遮罩透明度
                    shadeClose: true, // 点击遮罩区域，关闭弹层
                    maxmin: true, // 允许全屏最小化
                    anim: 0, // 0-6 的动画形式，-1 不开启
                    content: ['${ctxPath}/transferconfig/edit/'+trData.id,'yse'],
                });
            } else if (layEvent === "addChild") {
                layer.open({
                    type: 2, // page 层类型
                    area: ['500px', '650px'],
                    title: '添加',
                    shade: 0.6, // 遮罩透明度
                    shadeClose: true, // 点击遮罩区域，关闭弹层
                    maxmin: true, // 允许全屏最小化
                    anim: 0, // 0-6 的动画形式，-1 不开启
                    content: ['${ctxPath}/transferconfig/add?id='+trData.id,'yes'],
                });
            }
        });
    });
    // 获取平台列表
    new Ajax("${ctxPath}/newsplatform/getPlatformInfo", function (data) {
        console.log(data);
        if (data.code === 0 && BladeTool.isNotEmpty(data.data)) {
            var type = data.data;
            var html = ''; //
            for (var i = 0; i < type.length; i++) {
                if (type[i]==-1){
                    html += '<option value="' + type[i] + '">'+'请选择'+'</option>';
                }else {
                    html += '<option value="' + type[i] + '">' +'包'+ type[i] + '</option>';
                }
            }
            $("#clientType").html(html);
        }
        // 渲染select
        layui.use('form', function () {
            var form = layui.form;
            form.render("select");
        });
    }).start();
</script>
<!-- 引入列表页所需js -->
@include("/common/_listscript.html"){}
@}