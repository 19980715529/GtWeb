@layout("/common/_container.html"){
<script type="text/javascript">
    var ctx = "${ctxPath}";
    var grid_selector = "#grid-table";
    var pager_selector = "#grid-pager";
    var grid_data = [ ];
    var _filter = '{"StartTime":"' +getCurrentMonthFirst().format('yyyy-MM-dd') +'","EndTime":"' +getBeforeDate(0)+'","pid":"${id}"}';

    $(function() {
        backDom('新增充值统计详情','newrecharge');
        initGrid();
        // initMenuBtn("btns","newrecharge");
    });


    function initGrid() {
        var grid_url = ctx + "/newrecharge/details/list";//查询列表接口
        var _colnames=["id","时间", "充值人数","充值次数","充值总额","兑换人数","兑换总额","充提差","新增人均充值"];
        var _colmodel=[
            {name:"id",sortable:true,hidden:true},
            {name:"createTime",sortable:true},
            {name:"recUserNum", sortable:false},
            // 充值次数
            {name:"recNum",  sortable:false},
            // 充值总额
            {name:"recAmount", sortable:false},
            // 兑换人数
            {name:"excUserNum", sortable:false},
            // 兑换总额
            {name:"excAmount", sortable:false},
            // 充提差
            {name:"RE",  sortable:false},
            //
            {name:"avgRec", sortable:false}
        ];


        jQuery(grid_selector).jqGrid({
            url:grid_url,
            autowidth: true,
            shrinkToFit : false,//适用于较少字段,响应式
            colNames : _colnames,
            colModel : _colmodel,
            postData : {where:_filter,sort: "createTime", order: "desc"},
            jsonReader:{id:"id"},
            pager : pager_selector,
            multiselect : false, // 是否显示勾选框
            rownumbers : true, // 是否出现排序
            rowNum:100,
            height: 'auto'
        });
    }

</script>

<!-- 配置grid -->
<div class="row">
    <div class="col-xs-12 tb-grid">
        <form data-url="" method="post" class="" role="form">
            <!-- 配置查询 -->
            <div class="">
                <!-- 简单查询第一组 -->
                <label class=""> 时间： </label>
                <input type="text" id="start_time" placeholder="请输入时间段查询数据"/>
                -
                <input type="text" id="end_time" value="" class="" />
<!--                <label class=""> 包来源： </label>-->
<!--                <select id="clientType"></select>-->
                <!-- 简单查询按钮 -->
                <label class="">
                    <button class="btn btn-sx btn-white" type="button" onclick="search()">查询</button>
                    <button class="btn btn-sx btn-white" type="button" onclick="resetForm()">重置</button>
                </label>
            </div>
        </form>
        <label class=""> 合计数据： </label>
        <div class="col-xs-12 tb-grid">
        <table class="table table-bordered">
            <tbody>
            <tr>
                <td style="vertical-align: middle !important;text-align:right;" class="bg-F5F5F5">时间</td>
                <td style="vertical-align: middle !important;text-align:right;" class="bg-F5F5F5">新增用户</td>
                <td style="vertical-align: middle !important;text-align:right;" class="bg-F5F5F5">注册人数</td>
                <td style="vertical-align: middle !important;text-align:right;" class="bg-F5F5F5">充值人数</td>
                <td style="vertical-align: middle !important;text-align:right;" class="bg-F5F5F5">新增充值人数</td>
                <td style="vertical-align: middle !important;text-align:right;" class="bg-F5F5F5">新增充值次数</td>
                <td style="vertical-align: middle !important;text-align:right;" class="bg-F5F5F5">新增充值总额</td>
                <td style="vertical-align: middle !important;text-align:right;" class="bg-F5F5F5">新增兑换人数</td>
                <td style="vertical-align: middle !important;text-align:right;" class="bg-F5F5F5">新增兑换额度</td>
                <td style="vertical-align: middle !important;text-align:right;" class="bg-F5F5F5">新增充提差</td>
                <td style="vertical-align: middle !important;text-align:right;" class="bg-F5F5F5">新增人均充值</td>
                <td style="vertical-align: middle !important;text-align:right;" class="bg-F5F5F5">付费成本</td>
                <td style="vertical-align: middle !important;text-align:right;" class="bg-F5F5F5">投放成本</td>
            </tr>
            <tr>
                <td>${newrecharge.createTime}</td>
                <td>${newrecharge.newUserNum}</td>
                <td>${newrecharge.registerNum}</td>
                <td>${newrecharge.recUserNum}</td>
                <td>${newrecharge.newRecUser}</td>
                <td>${newrecharge.newRecNum}</td>
                <td>${newrecharge.newRecAmount}</td>
                <td>${newrecharge.newExcUser}</td>
                <td>${newrecharge.newExcAmount}</td>
                <td>${newrecharge.newRE}</td>
                <td>${newrecharge.averageRecharge}</td>
                <td>${newrecharge.cost}</td>
                <td>${newrecharge.deliveryCost}</td>
            </tr>
            </tbody>
        </table>
        </div>
        <!-- 按钮组 -->
<!--        <div class="welljq well-sm" id="btns"></div>-->
        <!-- grid -->
<!--        <label class=""> 详情数据： </label>-->
        <table id="grid-table"></table>
        <!-- 分页 -->
        <div id="grid-pager"></div>
    </div>
</div>
<script src="${ctxPath}/static/laydate/laydate.js"></script>
<script type="text/javascript">
    laydate({
        elem : '#start_time',
        format : 'YYYY-MM-DD', // 分隔符可以任意定义，该例子表示只显示年月日
        //festival: true, //显示节日
        // max: laydate.now(-1),
        choose : function(datas) { //选择日期完毕的回调
            /*   alert('得到：'+datas); */
        }
    });
    laydate({
        elem : '#end_time',
        format : 'YYYY-MM-DD', // 分隔符可以任意定义，该例子表示只显示年月日
        //festival: true, //显示节日
        // max: laydate.now(-1),
        choose : function(datas) { //选择日期完毕的回调
            /*   alert('得到：'+datas); */
        }
    });

    $(function(){
        $('#start_time').val(getCurrentMonthFirst().format('yyyy-MM-dd'));
        $('#end_time').val(getBeforeDate(0));
    });
    // 获取平台列表
    // new Ajax("${ctxPath}/newsplatform/getPlatformInfo", function (data) {
    //     console.log(data);
    //     if(data.code === 0 && BladeTool.isNotEmpty(data.data)) {
    //         var type = data.data;
    //         var html = '<option value="-1">请选择</option>';
    //         for (var i = 0; i < type.length; i++) {
    //             html += '<option value="' + type[i]['clientType'] + '">' + type[i]['name'] + '</option>';
    //         }
    //         $("#clientType").html(html);
    //     }
    // }).start();

    function search() {
        var wheres = {};
        var start_time = $("#start_time").val();
        var end_time = $("#end_time").val();
        var clientType = $("#clientType").val()
        if(BladeTool.isNotEmpty(end_time) && BladeTool.isEmpty(start_time)) {
            layer_alert('请输入开始时间!', "warn");
            return;
        } else if(BladeTool.isNotEmpty(end_time)) {
            wheres['EndTime'] = end_time;
        }
        if(BladeTool.isNotEmpty(start_time)) {
            wheres['StartTime'] = start_time;
            if(BladeTool.isEmpty(end_time)) {
                wheres['EndTime'] = getBeforeDate(1);
                $("#end_time").val(getBeforeDate(1));
            }
        }
        start_time = $("#start_time").val();
        end_time = $("#end_time").val();
        if(BladeTool.isNotEmpty(end_time) && BladeTool.isNotEmpty(start_time)) {
            if(start_time>end_time){
                layer_alert('开始时间不能大于结束时间!', "warn");
                return;
            }
        }
        if(BladeTool.isNotEmpty(clientType)) {
            wheres['clientType'] = clientType;
        }

        var filter = "";
        if (typeof (_filter) != "undefined") {
            filter = _filter;
        }
        var where = "";

        $.each(wheres, function(key, value) {
            if (BladeTool.isNotEmpty(key) && BladeTool.isNotEmpty(value)) {
                where += "\"" + key + "\":\"" + value + "\"" + ",";
            }
        });

        if (BladeTool.isNotEmpty(where)) {
            where = '{' + where;
            where = where.substring(0, where.length - 1);
            where += '}';
        }

        where = BladeTool.isEmpty(where) ? "" : encodeURI(where);
        isAutoPage = (BladeTool.isEmpty(where) ? true : false);
        var pageNum = $jqGrid.getGridParam('page');
        $jqGrid.jqGrid("setGridParam", {
            datatype : "json",
            postData : {
                where : where
            },
            page: (isAutoPage) ? pageNum : 1
        }).trigger("reloadGrid");
    }
    function resetForm() {
        $("input").val("");
        $('#start_time').val(getCurrentMonthFirst().format('yyyy-MM-dd'));
        $('#end_time').val(getBeforeDate(0));
    }
</script>

<!-- 引入列表页所需js -->
@include("/common/_listscript.html"){}
@}