@layout("/common/_container.html"){
<script src="${ctxPath}/static/layui-v2.8.4/layui/layui.js"></script>
<link href="${ctxPath}/static/layui-v2.8.4/layui/css/layui.css" rel="stylesheet">
<form class="layui-form layui-row layui-col-space16">
    <div class="layui-row">
        <div class="layui-col-xs12">
            <div class="layui-input-inline">
                <label class="layui-form-label">包来源:</label>
            </div>
            <div class="layui-input-inline">
                <select id="clientType" name="clientType">
                </select>
            </div>
            <div class="layui-input-inline" id="ID-laydate-range">
                <div class="layui-input-inline">
                    <label class="layui-form-label">时间:</label>
                </div>
                <div class="layui-input-inline">
                    <input type="text" name="StartTime" autocomplete="off" id="ID-laydate-start-date"
                           class="layui-input" placeholder="开始日期">
                </div>
                <div class="layui-input-inline">
                    <input type="text" name="EndTime" autocomplete="off" id="ID-laydate-end-date" class="layui-input"
                           placeholder="结束日期">
                </div>
            </div>
        </div>
    </div>

    <div class="layui-btn-container layui-col-xs12">
        <button class="layui-btn" lay-submit lay-filter="demo-table-search">查询</button>
        <button type="reset" class="layui-btn layui-btn-primary">重置</button>
    </div>
</form>
<div class="layui-row">
    <div class="layui-col-xs12">
        <div class="total-block">
            总充值金币：<span class="text-red" id="RecTotalGold"><b>0</b></span>
            总充值：<span class="text-red" id="RecTotalMoney"><b>0</b></span>
            总兑换：<span class="text-red" id="ExcTotalMoney"><b>0</b></span>
            充提差：<span class="text-red" id="RE"><b>0</b></span>
            系统总输赢：<span class="text-red" id="zsy"><b>0</b></span>
            总税收：<span class="text-red" id="totalTaxScores"><b>0</b></span>
            总注册：<span class="text-red" id="RegUserNum"><b>0</b></span>
            总奖励金币：<span class="text-red" id="RewardCoins"><b>0</b></span>
        </div>
    </div>
</div>
<table class="layui-hide" id="ID-table-demo-search"></table>
<script>
    var ctx = "${ctxPath}";
    var _filter = '{"StartTime":"' + getCurrentMonthFirst().format('yyyy-MM-dd') + '","EndTime":"' + getBeforeDate(0) + '","clientType":"-1"}';
    console.log(ctx + "/${code}/list")
    layui.use(function () {
        var laydate = layui.laydate;
        // 日期范围 - 左右面板独立选择模式
        laydate.render({
            elem: '#ID-laydate-start-date',
            value: getCurrentMonthFirst().format('yyyy-MM-dd'),
            isInitValue: true
        })
        laydate.render({
            elem: '#ID-laydate-end-date',
            value: getBeforeDate(0),
            isInitValue: true
        })
        laydate.render({
            elem: '#ID-laydate-range',
            range: ['#ID-laydate-start-date', '#ID-laydate-end-date']
        });
        var table = layui.table;
        var form = layui.form;
        // 创建表格实例
        table.render({
            elem: '#ID-table-demo-search'
            , url: ctx + "/${code}/list" // 此处为静态模拟数据，实际使用时需换成真实接口
            , toolbar: true
            , defaultToolbar: ['filter', 'exports', 'print']  //本章讲述的参数
            , where: {
                where: _filter,
                sort: "createTime",
                order: "desc",
                _search: false,
                nd: new Date().getTime(),
                sidx: "",
                sord: "asc"
            }
            , limit: 50
            , limits: [10, 50, 100]
            , request: {
                pageName: 'page', // 页码的参数名称，默认：page
                limitName: 'rows' // 每页数据条数的参数名，默认：limit
            },
            parseData: function (res) { // res 即为原始返回的数据
                return {
                    "code": res.code, // 解析接口状态
                    "msg": res.msg, // 解析提示文本
                    "count": res.data.records, // 解析数据长度
                    "data": res.data.rows // 解析数据列表
                };
            }
            , cols: [[
                {field: 'id', title: 'ID', width: 150, sort: true, fixed: 'left'}
                , {field: 'writeTime', title: '日期', width: 150, fixed: 'left'}
                , {field: 'newUserCount', title: '新增用户', width: 150, sort: true}
                , {field: 'regUser', title: '游客', width: 150}
                , {field: 'newUser', title: '注册用户', width: 150}
                , {field: 'activeUser', title: '登录人数', width: 150}
                , {field: 'recNum', title: '当日日充值人数', sort: true, width: 150}
                , {field: 'recMoney', title: '当日充值金额', sort: true, width: 150}
                , {field: 'newRecMoney', title: '当日新增充值总额', sort: true, width: 160}
                , {field: 'newRecNum', title: '单日新增充值人数', sort: true, width: 160}
                , {field: 'recTotalMoney', title: '累计充值总额', sort: true, width: 150}
                , {field: 'RechCount', title: '当日充值次数', sort: true, width: 150}
                , {field: 'excNum', title: '今日兑换人数', sort: true, width: 150}
                , {field: 'excMoney', title: '今日兑换总额', sort: true, width: 150}
                , {field: 'difference', title: '充提差', sort: true, width: 150}
                , {field: 'rechargeRate', title: '充值率', sort: true, width: 150}
                , {field: 'rechargeArpu', title: '充值ARPU', sort: true, width: 150}
                , {field: 'ARPPU', title: 'ARPPU', sort: true, width: 150}
                , {field: 'RewardCoins', title: '金币奖励', sort: true, width: 150}
                , {field: 'turntableTotal', title: '转盘使用总次数', sort: true, width: 150}
                , {field: 'ttl', title: '吞吐率', sort: true, width: 150}
                , {field: 'maxonline', title: '最高在线', sort: true, width: 150}
                , {field: 'payUserNum', title: '付费登录', sort: true, width: 150}
                , {field: 'tax', title: '税收', sort: true, width: 150}
                , {field: 'sysTotalWin', title: '系统输赢', sort: true, width: 150}
                , {field: 'controlValue', title: '当日点控值', sort: true, width: 150}
            ]]
            , totalRow: false // 开启合计行
            , page: true
            , height: 650
        });
        new Ajax("${ctxPath}/${code}/summary", function (data) {
            // RecTotalGold,RecTotalMoney,ExcTotalMoney,RE,RewardCoins,totalTaxScores,RegUserNum,zsy
            if (data.code === 0) {
                var temp = data.data;
                $("#RecTotalGold").text(fmoney(temp.RecTotalGold, 0));
                $("#RecTotalMoney").text(fmoney(temp.RecTotalMoney, 0));
                $("#ExcTotalMoney").text(fmoney(temp.ExcTotalMoney, 0));
                $("#RE").text(fmoney(temp.RE, 0));
                $("#RewardCoins").text(fmoney(temp.RewardCoins, 0));
                $("#totalTaxScores").text(fmoney(temp.totalTaxScores, 0));
                $("#RegUserNum").text(fmoney(temp.RegUserNum, 0));
                $("#zsy").text(fmoney(temp.zsy, 0));
            }
        }).start();
        // 搜索提交
        form.on('submit(demo-table-search)', function (data) {
            var field = data.field; // 获得表单字段
            console.log(field)
            // 执行搜索重载
            table.reload('ID-table-demo-search', {
                page: {
                    curr: 1 // 重新从第 1 页开始
                }
                , where: {
                    "where": JSON.stringify(field),
                    sort: "createTime",
                    order: "desc",
                    _search: false,
                    nd: new Date().getTime(),
                    sidx: "",
                    sord: "asc"
                }
            });
            // layer.msg('搜索成功<br>此处为静态模拟数据，实际使用时换成真实接口即可');
            return false; // 阻止默认 form 跳转
        });
    });
    // 获取平台列表
    new Ajax("${ctxPath}/newsplatform/getPlatformInfo", function (data) {
        console.log(data);
        if (data.code === 0 && BladeTool.isNotEmpty(data.data)) {
            var type = data.data;
            var html = '<option value="-1">请选择</option>';
            for (var i = 0; i < type.length; i++) {
                html += '<option value="' + type[i]['clientType'] + '">' + type[i]['name'] + '</option>';
            }
            $("#clientType").html(html);
        }
        // 渲染select
        layui.use('form', function () {
            var form = layui.form;
            form.render("select");
        });
    }).start();
</script>
<!-- 引入列表页所需js -->
@include("/common/_listscript.html"){}
@}